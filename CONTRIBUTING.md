If you like to contribute to `osquery-rust`, please keep the following in mind. Please note, not all might
be relevant to you. It depends on what you contribute.

# Some coding style guide

We rely on `cargo fmt#` for coding style. However, there are some aspects cargo fmt does not covery.

## Ordering of terms in derive

Differentiate between terms from standard library and 3rd party crates. Refer to 
third party first. Order within both groups alphabetically.

Wrong:

    #[derive(VariantNames, Debug, Eq, PartialEq, Hash, EnumString)]

Correct:

    #[derive(EnumString, VariantNames, Debug, Eq, Hash, PartialEq)]

# Osquery's plugin interface

Osquery and its plugins communicate via an interface based on Apache Thrift. So,
`osquery-rust` is a wrapper around that interface and turns it into a powerful API.

The beauty of a Thrift based interface is, that this is interface is formally described 
and can be turned into code via the Apache Thrift compiler.

This chapter addresses developers contributing to `osquery-rust` and describes 
how to turn the interface description into code.

## Install / update the tools

Make sure to use up-to-date tools and adopt the following to you specific dev 
environment. All lines starting with '$' show commands executed as unprivileged user.
`PROJECT_ROOT` is the directory containing the `osquery-rust` repository.

Pacman is the package manager on Arch based Linux distributions. Make sure, `rustup` 
is up-to-date.

    $ pacman -sS rustup
    extra/rustup 1.26.0-5 [installed]
        The Rust toolchain installer

Check if Rust toolchain is up-to-date, if not update it with `rustup`.

    $ cargo --version
    cargo 1.77.2 (e52e36006 2024-03-26)
    $ rustc --version
    rustc 1.77.2 (25ef9e3d8 2024-04-09)


Install or update the Thrift compiler.

    $ pacman -sS thrift
    extra/thrift 0.19.0-1
        Scalable cross-language services framework for IPC/RPC
    $ sudo pacman -S thrift
    $ thrift -version
    Thrift version 0.19.0

**Todo: Clarify if a newer Thrift compiler could be a problem when the Thrift crate 
available on crates.io is older. So far, this has never been a problem.**

## Get latest Thrift interface description from osquery

The interface description 
is available in the [osquery repository](https://github.com/osquery/osquery).

This is how we get that interface description.

    $ git clone https://github.com/osquery/osquery
    $ cd osquery/
    $ find . -name osquery.thrift
    ./osquery/extensions/thrift/osquery.thrift

**Todo: Create a script to get and compare interface description to the one actually 
used in `osquery-rust`. Use that script as part of CI / CD as a quality assurance measure.**

## Generate Rust code from interface description

This is how to generate Rust code from the interface description. The result is written 
to `src/osquery.rs`.

**Note: Within the `osquery-rust` project, the interface description is used in 
crate `osquery-rust` in the `_osquery` module.

    $ cd ${PROJECT_ROOT}/osquery-rust/
    $ thrift -out src/_osquery --gen rs -r osquery.thrift
    $ head -1 src/_osquery/osquery.rs
    // Autogenerated by Thrift Compiler (0.19.0)

# Links

https://github.com/osquery osquery GitHub repo

https://github.com/osquery/osquery-go osquery Go bindings GitHub repo

https://github.com/apache/thrift thrift GitHub Repo
https://github.com/apache/thrift/tree/master/tutorial/rs Rust Language Bindings for Thrift Tutorial

https://prateeknischal.github.io/posts/apache-thrift-over-unix-sockets/ Unix Socket

https://github.com/apache/thrift/blob/master/CONTRIBUTING.md
